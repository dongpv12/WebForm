@model WebForm.Models.Symbol_Notify_Info
@using WebForm.Models
@using WebForm.Common
@using Common
@{
    ViewBag.Title = "Sửa bài viết";
    Layout = "_Layout_Admin";

    List<Allcode_Info> status = DataMemory.GetAllcodeByName("SYMBOL", "STATUS");


}

<link href="~/datetimepicker/jquery.datetimepicker.min.css" rel="stylesheet" />
<script src="~/datetimepicker/jquery.datetimepicker.full.js"></script>

<style>
    .displaynone {
        display: none;
    }
</style>


<input type="hidden" id="txtId" value="@Model.Id" />
<div class="container-fluid">



    <div class="form-group row" id="f_txtSymbol">
        <label for="txtTitle" class="col-sm-2 col-form-label">Mã cổ phiếu</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtSymbol" maxlength="100" value="@Model.Symbol"/>
        </div>
    </div>


    <div class="form-group row" id="f_txtSymbolName">
        <label for="txtTitle" class="col-sm-2 col-form-label">Tên cổ phiếu</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtSymbolName" maxlength="1000" value="@Model.Name" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Tên Doanh nghiệp</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtIssue" maxlength="1000" value="@Model.Issue" />
        </div>
    </div>

    <div class="form-group row">
        <label for="txtType" class="col-sm-2 col-form-label">Trạng thái</label>
        <div class="col-sm-10">
            <select class="form-control" id="txtStatus">
                @foreach (var item in status)
                {
                    if (item.CdValue == Model.Status)
                    {
                        <option value="@item.CdValue" selected>@item.CdContent</option>
                    }
                    else
                    {
                        <option value="@item.CdValue">@item.CdContent</option>
                    }
                   
                }
            </select>
        </div>
    </div>

    @* // ngày mở vị thế : Open Position Date *@
    <div class="form-group row">
        <label for="txtTitle" class="col-sm-2 col-form-label">Ngày mở vị thế</label>
        <div class="col-sm-10">
            <input type="text" class=" form-control datepublic" id="datepublic" value="@Model.Open_Position_Date" />
        </div>
    </div>

    <div class="form-group row">
        <label for="txtTitle" class="col-sm-2 col-form-label">Ngày đóng vị thế</label>
        <div class="col-sm-10">
            <input type="text" class=" form-control datepublic" id="Close_Position_Date" value="@Model.Close_Position_Date" />
        </div>
    </div>


    <div class="form-group row" id="f_txtIssue" >
        <label for="txtTitle" class="col-sm-2 col-form-label">Vùng mua dự kiến (từ)</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtF_PRICE_Exp" maxlength="1000" value="@Model.F_PRICE_Exp.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Vùng mua dự kiến (đến)</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtT_PRICE_Exp" maxlength="1000" value="@Model.T_PRICE_Exp.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Giá mục tiêu</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtF_PRICE_Target" maxlength="1000" value="@Model.F_PRICE_Target.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Giá đóng vị thế</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtT_PRICE_Target" maxlength="1000" value="@Model.T_PRICE_Target.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Giá dừng lỗ</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtT_Pause" maxlength="1000" value="@Model.T_Pause.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Earning Trung bình 4 quý gần nhất</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtDoanhThu" maxlength="1000" value="@Model.DoanhThu.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Tăng trưởng Lợi nhuận (%)</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtLoinhuan" maxlength="1000" value="@Model.LoiNhuan.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>


    <div class="form-group row" id="f_txtIssue">
		<label for="txtTitle" class="col-sm-2 col-form-label">Giá mua</label>
		<div class="col-sm-10">
            <input type="text" class="form-control" id="txtPrice" maxlength="20" value="@Model.Price.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
		</div>
	</div>

    <div class="form-group row" id="f_txtIssue">
        <label for="txtTitle" class="col-sm-2 col-form-label">Giá bán</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtSellPrice" maxlength="20" value="@Model.Sell_Price.ToNumberStringN10()" onkeyup="jsFormatFloatNumber(this, 3)" />
        </div>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">&nbsp;</label>
        <div class="col-sm-10">
            @if (Model.IsSpecial == "Y")
            {  <input type="checkbox" id="cbxSpecial" checked>  <label class="checkbox-inline">Theo dõi</label>
                
            }else{
                  <input type="checkbox" id="cbxSpecial">  <label class="checkbox-inline">Theo dõi</label>
            }
          
        </div>
    </div>



    <div class="form-group row">
        <label for="txtTitle" class="col-sm-2 col-form-label">Khuyến nghị</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtNote" maxlength="1000" value="@Model.Note" />
        </div>
    </div>


    <div class="form-group row">
        <label for="txtTitle" class="col-sm-2 col-form-label">Ghi chú (nếu có)</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="txtGhichu" maxlength="1000" value="@Model.Ghichu" />
        </div>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">&nbsp;</label>
        <div class="col-sm-10">
            <input type="button" class="btn btn-primary" id="btnCreate" value="Lưu lại" onclick="return createNews()" />
            <input type="button" class="btn" id="btnCancel" value="Hủy" onclick="window.location.href='/Symbol/List'" />
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {


         $.datetimepicker.setLocale('vi');
         $('.datepublic').datetimepicker({
             format: 'd/m/Y',
             formatDate: 'd/m/Y',
             timepicker: false,
             mask: '39/19/9999',
             validateOnBlur: true,
         });
     })

  

    var lockSubmit = false;

  
    function createNews() {
        var isSpecial = 'N';
        if ($('#cbxSpecial').is(':checked')) {
            isSpecial = 'Y';
        }

        if (lockSubmit) {
            return;
        }

        var title = $('#txtSymbol').val();
        if(title == null || title == ""){
            alert("Mã cổ phiếu không được để trống");
            $('#txtSymbol').focus();
            return;
        }


        var datepublic = $("#datepublic").val().trim();

            if (datepublic == "__/__/____") {
                datepublic = "";
            }

        var Close_Position_Date = $("#Close_Position_Date").val().trim();

        if (Close_Position_Date == "__/__/____") {
            Close_Position_Date = "";
        }

        var request = {
            id: $('#txtId').val(),
            Symbol: $('#txtSymbol').val().trim(),
            Name: $('#txtSymbolName').val(),
            Issue: $('#txtIssue').val(),
            Status : $("#txtStatus").val(),
            F_PRICE_Exp : $("#txtF_PRICE_Exp").val().replace(/,/g, "")  || '0',
            T_PRICE_Exp : $("#txtT_PRICE_Exp").val().replace(/,/g, "")  || '0',
            F_PRICE_Target : $("#txtF_PRICE_Target").val().replace(/,/g, "")  || '0',
            T_PRICE_Target : $("#txtT_PRICE_Target").val().replace(/,/g, "")  || '0',
            T_Pause : $("#txtT_Pause").val().replace(/,/g, "")  || '0',
            DoanhThu : $("#txtDoanhThu").val().replace(/,/g, "")  || '0',
            LoiNhuan : $("#txtLoinhuan").val().replace(/,/g, "")  || '0',
            IsSpecial : isSpecial,
            Price : $("#txtPrice").val().replace(/,/g, "")  || '0',
            Sell_Price : $("#txtSellPrice").val().replace(/,/g, "")  || '0',
            Open_Position_Date : datepublic,
            Note : $('#txtNote').val().trim(),
            Close_Position_Date : Close_Position_Date,
            Ghichu : $('#txtGhichu').val().trim(),
        };
        lockSubmit = true;
        axios.post("/Symbol/Edit", request).then(function (response) {
            var data = response.data;
            if (data.Status) {
                swal({
                    title: "Thành công",
                    text: "Sửa cổ phiếu thành công",
                    icon: "success",
                    buttons: true
                }).then((value) => {
                    window.location = "/Symbol/List";
                });
            } else {
                swal({
                    title: "Lỗi",
                    text: data.Message,
                    icon: "warning",
                    buttons: true
                });
            }
            lockSubmit = false;
        }).catch(error => {
            swal({
                title: "Lỗi",
                text: "Vui lòng thử lại vào lúc khác",
                icon: "warning",
                buttons: true
            });
            lockSubmit = false;
        });
    }


    


  
</script>

