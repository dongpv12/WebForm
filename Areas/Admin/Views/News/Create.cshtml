@{
	ViewBag.Title = "Tạo mới";
	Layout = "_Layout_Admin";
}

<script src="/ckeditor/ckeditor.js"></script>
<script src="/ckfinder/ckfinder.js"></script>

<div class="container-fluid">

	<div class="form-group row">
		<label for="txtType" class="col-sm-2 col-form-label">Loại tin</label>
		<div class="col-sm-10">
			<select class="form-control" id="txtType">
				<option value="1">Xu hướng thị trường</option>
				<option value="2">Xu hướng ngành</option>
				<option value="3">Cổ phiếu dẫn dắt</option>
				<option value="4">Lọc cổ phiếu</option>
				<option value="5">Báo cáo FinArt</option>
				<option value="6">Báo cáo Công ty Chứng khoán</option>
				<option value="7">Báo cáo ngành</option>
			</select>
		</div>
	</div>

	<div class="form-group row">
		<label for="txtTitle" class="col-sm-2 col-form-label">Tiêu đề</label>
		<div class="col-sm-10">
			<input type="text" class="form-control" id="txtTitle" />
		</div>
	</div>
	<div class="form-group row">
		<label for="txtDescription" class="col-sm-2 col-form-label">Mô tả</label>
		<div class="col-sm-10">
			<textarea class="form-control" rows="5" id="txtDescription"></textarea>
		</div>
	</div>
	<div class="form-group row">
		<label for="txtFeatureImage" class="col-sm-2 col-form-label">Ảnh đại diện</label>
		<div class="col-sm-10">
			<img id="imgFeature" src="/Images/img-not-available.jpg" style="width: 100px; height: 100px" />
			<input type="hidden" class="form-control" id="txtFeatureImage" />
			<input type="button" value="Chọn ảnh" class="btn" onclick="ShowImage()" />
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">&nbsp;</label>
		<div class="col-sm-10">
			<input type="checkbox" id="cbxSpecial" value="">  <label class="checkbox-inline">Đặc biệt</label>
		</div>
	</div>
	<div class="form-group row">
		<label for="txtFeatureImage" class="col-sm-2 col-form-label">Nội dung</label>
		<div class="col-sm-10">
			@* <input class="form-control" id="txtContent" /> *@
			<textarea name="txtContent" id="txtContent"></textarea>
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">&nbsp;</label>
		<div class="col-sm-10">
			<input type="button" class="btn btn-primary" id="btnCreate" value="Tạo bài viết" onclick="return CreateNews()" />
			<input type="button" class="btn" id="btnCancel" value="Hủy" />
		</div>
	</div>
</div>
<div id="browseImageContainer"></div>
<script>


	$( document ).ready(function() {

	   // var editor = CKEDITOR.replace('txtContent');

	   // CKFinder.setupCKEditor(editor);


		


	});

	var editor = CKEDITOR.replace('txtContent', {
		filebrowserBrowseUrl: '/ckfinder-ftp/browse',
		filebrowserUploadUrl: '/ckfinder-ftp/upload',
		extraAllowedContent: 'iframe[*]',
		allowedContent: true
		});
		CKFinder.setupCKEditor(editor);


	var lockSubmit = false;
	 function ShowImage() {
			// var finder = new CKFinder();
			// finder.selectActionFunction = function (url) {
			//     $('#imgFeature').attr('src', url);
			//     $('#txtFeatureImage').val(url);
			// }
			// finder.popup();

			 window.SetImageFromPopup = function (imgUrl) {
				$('#imgFeature').attr('src', imgUrl);
				$('#txtFeatureImage').val(imgUrl);
			};
			var browseUrl = '/ckfinder-ftp/browseImage';
			window.open(browseUrl, 'BrowseWindow', 'width=800,height=600');


	 }

	function CreateNews() {
		var isSpecial = 'N';
		if ($('#cbxSpecial').is(':checked')) {
			isSpecial = 'Y';
		}
		if (lockSubmit) {
			return;
		}
		lockSubmit = true;


		var request = {
			 content: editor.getData(),
			 featureImage: $('#txtFeatureImage').val(),
			 title: $('#txtTitle').val(),
			 description: $('#txtDescription').val(),
			 special: isSpecial
		};

		axios.post("/News/DoCreate", request).then(function (response) {
			var data = response.data;
			if (data.Status) {
				swal({
					title: "Thành công",
					text: "Tạo bài viết thành công",
					icon: "success",
					buttons: true
				}).then((value) => {
					window.location = "/News/List";
				});
			} else {
				swal({
					title: "Lỗi",
					text: "Vui lòng thử lại vào lúc khác",
					icon: "warning",
					buttons: true
				});
			}
			lockSubmit = false;
		}).catch(error => {
			swal({
				title: "Lỗi",
				text: "Vui lòng thử lại vào lúc khác",
				icon: "warning",
				buttons: true
			});
			lockSubmit = false;
		});
	}


</script>

