@using WebForm.Common;
@using System.Data;
@using System.Diagnostics;
@using Microsoft.AspNetCore.Mvc;
@using WebForm.Helpers;
@using WebForm.Models;
@using Common;
@using System.Globalization;

@{

    Layout = "~/Views/Shared/_Layout.cshtml";


    List<Symbol_Notify_Info> _Symbol = DataMemory.GetAllSymbol().Where(x => x.Status == "2").ToList();


    var listSorted = _Symbol.OrderByDescending(x =>
        {
            if (string.IsNullOrWhiteSpace(x.Close_Position_Date))
                return DateTime.MaxValue; // cho xuống cuối nếu null hoặc trống

            DateTime date;
            bool ok = DateTime.TryParseExact(
        x.Close_Position_Date,
        "dd/MM/yyyy",
        CultureInfo.InvariantCulture,
        DateTimeStyles.None,
        out date
    );

            return ok ? date : DateTime.MaxValue; // nếu sai định dạng thì cho xuống cuối
        }).ToList();


}
<link href="~/datetimepicker/jquery.datetimepicker.min.css" rel="stylesheet" />
<script src="~/datetimepicker/jquery.datetimepicker.full.js"></script>

<style>
    table {
        border-collapse: collapse;
        width: 100%;
        text-align: center;
        table-layout: fixed;
    }

    col {
        width: 10%;
    }

    th, td {
        border: 1px solid #999;
        padding: 6px 8px;
        vertical-align: middle;
        /* word-wrap: break-word; */
    }

    .headerth {
        background-color: #258749 !important;
    }

    .sub-header {
        background-color: #6cd392;
    }

    .zebra:nth-child(even) {
        background-color: #f9f9f9;
    }

    .zebra:nth-child(odd) {
        background-color: #ffffff;
    }

    tr th {
        font-family: Lexenddeca_light
    }

    .section-header {
        background-color: #b7f1cb;
        color: #16315e;
        font-family: Lexenddeca_B;
    }

    .column-header {
        background-color: #d58a35;
        font-family: Lexenddeca_light;
        color: #f9f9f9;
    }

    td {
        font-size: 15px;
    }

    #app td {
        color: #221e1e !important;
        font-size: 15px;
    }


    .btnsearch {
        border: 1px solid green;
        color: #fff;
        background: #258749;
        /* height: 35px; */
        padding: 4px 15px;
        border-radius: 5px;
    }

        .btnsearch:hover {
            transform: scale(1.05); /* phóng to nhẹ */
        }

    @@media screen and (max-width: 768px) {
        .hidden-mobile {
            display: none;
        }

        .show-mobile {
            display: revert-layer;
        }
    }

    @@media screen and (min-width: 769px) {
        .hidden-mobile {
            display: revert-layer;
        }

        .show-mobile {
            display: none;
        }
    }
</style>

<div class="area-page-title">
    <div class="container">
        <h1 class="animate a_01" style="">Lịch sử khuyến nghị</h1>
        <ol class="breadcrumb animate a_02">
            <li class="breadcrumb-item">
                <a href="/">Trang chủ</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Lịch sử khuyến nghị</li>
        </ol>
    </div>
</div>

<section id="service-details" class="service-details section">
    <div id="trading">
        <div class="container">

            <div class="row gy-4">


                <div class="col-12">


                    <div>
                        <div class="form-group row">

                            <div class="col-sm-3">
                                <p style=" font-size: 13px">Mã cổ phiếu</p>
                                <input type="text" class="form-control" id="code" maxlength="1000" value="" style="height:33px; font-size: 13px" autocomplete="off" />
                            </div>


                            <div class="col-sm-3">
                                <p style=" font-size: 13px">Ngày chốt (từ ngày)</p>
                                <input type="text" class="form-control datepublic" id="from_date" maxlength="1000" value="" style="height:33px; font-size: 13px" autocomplete="off" />
                            </div>


                            <div class="col-sm-3">
                                <p style=" font-size: 13px">Ngày chốt (đến ngày)</p>
                                <input type="text" class=" form-control datepublic" id="to_date" style="height:33px; font-size: 13px" autocomplete="off" />
                            </div>

                            <div class="col-sm-3" style="text-align: right">
                                <p><i> &nbsp;</i></p>
                                <button class="btnsearch" onclick="OnSearch()">Tìm kiếm</button>
                                <button class="btnsearch" onclick="OnExport()">Kết xuất</button>
                            </div>
                        </div>
                    </div>

                    <div id="app">
                        <div class="table-responsive shadow-sm" id="data_search">


                            @Html.Partial("DataSymbolBuy")

                        </div>
                    </div>
                </div>



            </div>

        </div>
    </div>
</section>
<script>

    $(document).ready(function () {
        $.datetimepicker.setLocale('vi');

        $('.datepublic').datetimepicker({
            format: 'd/m/Y',        // định dạng hiển thị
            formatDate: 'd/m/Y',    // định dạng parse
            timepicker: false,      // tắt chọn giờ
            mask: true,             // auto mask
            validateOnBlur: true    // validate khi rời khỏi input
        });
    });

    function OnSearch(){
        try{
            var code = $("#code").val();
            var from_date = $("#from_date").val();
            var to_date = $("#to_date").val();


            if(from_date == null || from_date == "__/__/____"){
                from_date = "";
            }

             if(to_date == null || to_date == "__/__/____"){
                  to_date = "";
            }



            var request = {
                Code: code,
                From_Date: from_date,
                To_Date: to_date
            };
            axios.post("/Home/SearchCoPhieu", request).then(function (response) {
                $('#data_search').html(response.data);
            }).catch(error => {
                 console.log(error);
            });

        }catch(ex){
            console.log(ex)
        }
    }



     function OnExport(){
        try{
            var code = $("#code").val();
            var from_date = $("#from_date").val();
            var to_date = $("#to_date").val();


            if(from_date == null || from_date == "__/__/____"){
                from_date = "";
            }

             if(to_date == null || to_date == "__/__/____"){
                  to_date = "";
            }



            var request = {
                Code: code,
                From_Date: from_date,
                To_Date: to_date
            };
            axios.post("/Home/ExportCoPhieu", request).then(function (response) {

                   
                    if (response.data.success > 0) {
                        
                        window.location.href = "/download/" + response.data.filePath;
                    }
                    else {
                       
                    }
            }).catch(error => {
                 console.log(error);
            });

        }catch(ex){
            console.log(ex)
        }
    }




</script>
